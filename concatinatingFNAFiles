import os
import fileinput
from collections import OrderedDict
import shutil
'This program concatenates files in a large amount of directories into directory.extension '
'This script was designed to concatenate DNA files from all.fna downloaded from NCBI database on a unix machine into'
'/user/directory/directory.extension'

'example:'
'user/directory1/file1.ext'
'user/directory1/file2.ext'
'this program will turn directory1 into'
'user/directory1/directory1.ext'
'where directory1 is cat file1.ext file2.ext > dictionary1.ext'
'user/directory2/file.ext will be unchanged, where dictionary2 has only file.ext'
'run concatinatingFNAFile.py, then run ChangeFileToDirectory.py to achieve user/dicrectory1/directory1.ext for all'

directory = '/Users/jon6/Desktop/all.fna'
ext = ".fna"

currentDirectory = None
previousDirectory = None
listOfDirectoriesWithMultipleFNAfiles = []
listOfDirectoriesWithMultipleFNAfilesNoRepeats = []
x = 0
for subdir, dirs, files in os.walk(directory, topdown=True):
    for file in files:
        currentDirectory = subdir
        if currentDirectory == previousDirectory:
            listOfDirectoriesWithMultipleFNAfiles.insert(x, currentDirectory)
            x +=1
        previousDirectory = subdir
listOfDirectoriesWithMultipleFNAfilesNoRepeats = list(OrderedDict.fromkeys(listOfDirectoriesWithMultipleFNAfiles))
print (listOfDirectoriesWithMultipleFNAfilesNoRepeats)

listOfFNAfiles = []
catCommand = None
newFNAfileName = None
for dirFile in listOfDirectoriesWithMultipleFNAfilesNoRepeats:
    uniqueFiles = True
    print(dirFile)
    base = os.path.basename(dirFile)
    fnaConstruct = (os.path.join(dirFile, base))
    newFNAfileName = fnaConstruct+ext
    for root, dir, files in os.walk(dirFile, topdown=True):
        for f in files:
            currentFile = ((os.path.join(root, f)))
            print (currentFile)
            if newFNAfileName == currentFile:
                print ("run already done before, error")
                uniqueFiles = False
                break
            if f.endswith(ext):
                catFileTo = ((os.path.join(root, f)))
                listOfFNAfiles.append(catFileTo+' ')
                print (catFileTo)

    if uniqueFiles:
        string1 = ''.join(listOfFNAfiles)
        catCommand = "cat " + string1 + " > " + newFNAfileName
        print (catCommand)
        os.system(catCommand)
        rmCommand = "rm " + string1
        print(rmCommand)
        os.system(rmCommand)
        listOfFNAfiles = []
        catCommand = None
        newFNAfileName = None
        string1 = None

listOfDirectoriesWithMultipleFNAfilesNoRepeats = None
