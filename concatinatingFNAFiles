import os
import fileinput
from collections import OrderedDict
import shutil
'This program concatenates files in a large amount of directories into directory.extension '
'This script was designed to concatenate DNA files from all.fna downloaded from NCBI database on a unix machine into'
'/user/directory/directory.extension'

'example:'
'user/directory1/file1.ext'
'user/directory1/file2.ext'
'this program will turn directory1 into'
'user/directory1/directory1.ext'
'where directory1 is cat file1.ext file2.ext > dictionary1.ext'
'user/directory2/file.ext will be unchanged, where dictionary2 has only file.ext'

directory = '/Users/jon6/Desktop/all.fna'
ext = ".txt"

currentDirectory = None
previousDirectory = None
listOfDirectoriesWithMultipleFNAfiles = []
listOfDirectoriesWithMultipleFNAfilesNoRepeats = []
x = 0
for subdir, dirs, files in os.walk(directory, topdown=True):
    for file in files:
        currentDirectory = subdir
        if currentDirectory == previousDirectory:
            listOfDirectoriesWithMultipleFNAfiles.insert(x, currentDirectory)
            x +=1
        previousDirectory = subdir
listOfDirectoriesWithMultipleFNAfilesNoRepeats = list(OrderedDict.fromkeys(listOfDirectoriesWithMultipleFNAfiles))
print (listOfDirectoriesWithMultipleFNAfilesNoRepeats)

listOfFNAfiles = []
catCommand = None
newFNAfileName = None
for dirFile in listOfDirectoriesWithMultipleFNAfilesNoRepeats:
    uniqueFiles = True
    print(dirFile)
    base = os.path.basename(dirFile)
    fnaConstruct = (os.path.join(dirFile, base))
    newFNAfileName = fnaConstruct+ext
    for root, dir, files in os.walk(dirFile, topdown=True):
        for f in files:
            currentFile = ((os.path.join(root, f)))
            print (currentFile)
            if newFNAfileName == currentFile:
                print ("run already done before, error")
                uniqueFiles = False
                break
            if f.endswith(ext):
                catFileTo = ((os.path.join(root, f)))
                listOfFNAfiles.append(catFileTo+' ')
                print (catFileTo)

    if uniqueFiles:
        string1 = ''.join(listOfFNAfiles)
        catCommand = "cat " + string1 + " > " + newFNAfileName
        print (catCommand)
        os.system(catCommand)
        rmCommand = "rm " + string1
        print(rmCommand)
        os.system(rmCommand)
        listOfFNAfiles = []
        catCommand = None
        newFNAfileName = None
        string1 = None

listOfDirectoriesWithMultipleFNAfilesNoRepeats = None



'''
old, buggy version

import os
import fileinput
from collections import OrderedDict
directory = '/Users/jon6/Desktop/test.fna'

currentDirectory = None
previousDirectory = None
listOfDirectoriesWithMultipleFNAfiles = []
listOfDirectoriesWithMultipleFNAfilesNoRepeats = []
x = 0
for subdir, dirs, files in os.walk(directory, topdown=True):
    for file in files:
        currentDirectory = subdir
        '''print ("current:{0}".format(currentDirectory))'''
        if currentDirectory == previousDirectory:
            '''print ("same as previous")'''
            listOfDirectoriesWithMultipleFNAfiles.insert(x, currentDirectory)
            x +=1
        previousDirectory = subdir
        '''print (file)'''
listOfDirectoriesWithMultipleFNAfilesNoRepeats = list(OrderedDict.fromkeys(listOfDirectoriesWithMultipleFNAfiles))
'''print (listOfDirectoriesWithMultipleFNAfilesNoRepeats)'''

newFNAfileName = None
listOfFNAfiles = []
z = 0
for dirFiles in listOfDirectoriesWithMultipleFNAfilesNoRepeats:
    for root, dir, files in os.walk(dirFiles, topdown=True):
        newFNAfileName = (root) + '.txt'
        '''print (newFNAfileName)'''
        for file in files:
            listOfFNAfiles.insert(z, format(os.path.join(root, file)))
            z += 1
            '''print("file:" + format(z))'''

    '''print (listOfFNAfiles)
    print (newFNAfileName)
    print ("directory name:{0}".format(os.path.join(root, file)))
    '''
    '''
    with open(newFNAfileName, "wb") as outfile:
        for FNAfile in listOfFNAfiles:
            with open(FNAfile, "rb") as infile:
                outfile.write(infile.read())
    '''

    '''
    with open(newFNAfileName, 'w') as newFNAfile:
        input_lines = fileinput.input(listOfFNAfiles)
        newFNAfile.writelines(input_lines)
    '''

with open(newFNAfileName, 'w') as result:
    for FNAfile in listOfFNAfiles:
        print (FNAfile)
        for line in open(FNAfile, 'r'):
            result.write(line)
'''
