from __future__ import division
import sys
import os
from collections import OrderedDict
import subprocess

def process_data(path):
   with open(path) as input_file:
       for line in input_file:
           chunk = line.strip().split(' ')
           if len(chunk) == 7:
               yield chunk


def calculateANI(path):
   x=0
   list1 = []
   oneHundredANI = False
   for piece in process_data(path):
       if piece[0] == piece[2]:
           if piece[4] and piece[5] == '0':
               oneHundredANI = True
               length = abs(((int(piece[1])-int(piece[0]))) + abs((int(piece[3])-int(piece[2])))) / 2
               ANI = ((length - int(piece[5])) / length) * 100
               list1.insert(x, ANI)
               x += 1
               break

   if not oneHundredANI:
       for piece in process_data(path):
           length = abs(((int(piece[1])-int(piece[0]))) + abs((int(piece[3])-int(piece[2])))) / 2
           ANI = ((length - int(piece[5])) / length) * 100
           list1.insert(x, ANI)
           x += 1

   if not list1:
       return
   else:
       return ((sum(list1)/ x))


vs = '__vs__'

mummerBaseDirectory = '/Users/jon6/MUMmer3.23/'
deltaFilesNamesDirectory = '/Users/jon6/MUMmer3.23/allDeltaFiles/'
ext = ".delta"

listOfFiles = []
for root, subdir, files in os.walk(deltaFilesNamesDirectory, topdown=True):
   for file in files:
       currentDirectory = subdir
       if file.endswith(ext):
           currentFile = ((os.path.join(root, file)))
           listOfFiles.append(currentFile)
listOfFilesNoRepeats = list(OrderedDict.fromkeys(listOfFiles))

n =  len(listOfFilesNoRepeats)

print listOfFilesNoRepeats

compareString = "%ANI is low"
for i in range(0,n):
   s = calculateANI(listOfFilesNoRepeats[i])
   if s:
       if s != compareString:
           print (str(os.path.basename(listOfFilesNoRepeats[i])) + ": " +str(s) + "%")
